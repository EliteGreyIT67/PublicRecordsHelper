<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Public Records Request Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="css/custom.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="transition-colors duration-300" :class="darkMode ? 'bg-gray-900' : 'bg-gray-50'" x-data="publicRecordsApp()" x-init="init()">
    <!-- Header -->
    <header class="transition-colors duration-300" :class="darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'" class="shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Public Records Request Generator</h1>
                    <p class="text-sm mt-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-600'">Generate professional public records requests with proper legal citations</p>
                </div>
                <div class="flex gap-2">
                    <button @click="toggleDarkMode()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md transition-colors">
                        <i class="fas" :class="darkMode ? 'fa-sun' : 'fa-moon'"></i>
                        <span class="ml-2 hidden sm:inline" x-text="darkMode ? 'Light' : 'Dark'"></span>
                    </button>
                    <button @click="startOver()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md transition-colors">
                        <i class="fas fa-refresh mr-2"></i>Start Over
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Form Section -->
            <div class="rounded-lg shadow-md p-6 transition-colors duration-300" :class="darkMode ? 'bg-gray-800' : 'bg-white'">
                <h2 class="text-xl font-semibold mb-6 transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Request Details</h2>
                
                <!-- State Selection - Primary -->
                <div class="mb-6 p-4 rounded-lg transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-blue-50 border-blue-200'" style="border: 2px solid;">
                    <label class="block text-sm font-medium mb-2 transition-colors duration-300" :class="darkMode ? 'text-gray-200' : 'text-blue-800'">
                        <i class="fas fa-map-marker-alt mr-2"></i>Select Your State (Required)
                    </label>
                    <select x-model="form.state" @change="onStateChange()" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-600 border-gray-500 text-white' : 'bg-white border-gray-300 text-gray-900'">
                        <option value="">Choose your state...</option>
                        <template x-for="law in laws" :key="law.code">
                            <option :value="law.code" x-text="`${law.name} (${law.code})`"></option>
                        </template>
                    </select>
                    <template x-if="selectedLaw">
                        <div class="mt-2 text-sm transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-blue-700'">
                            <p><strong>Law:</strong> <span x-text="selectedLaw.lawName"></span></p>
                            <p><strong>Response Time:</strong> <span x-text="selectedLaw.responseTime"></span></p>
                            <p><strong>Fee Structure:</strong> <span x-text="selectedLaw.feeStructure"></span></p>
                        </div>
                    </template>
                </div>

                <!-- Template Selection -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">
                            <i class="fas fa-file-alt mr-2"></i>Quick Templates
                        </label>
                        <button @click="openTemplateWizard()" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded-md text-sm transition-colors">
                            <i class="fas fa-magic mr-1"></i>Create Custom Template
                        </button>
                    </div>
                    <select x-model="selectedTemplate" @change="applyTemplate()" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'">
                        <option value="">Select a template...</option>
                        <optgroup label="Built-in Templates">
                            <template x-for="template in templates" :key="template.id">
                                <option :value="template.id" x-text="template.name"></option>
                            </template>
                        </optgroup>
                        <template x-if="customTemplates.length > 0">
                            <optgroup label="My Custom Templates">
                                <template x-for="template in customTemplates" :key="template.id">
                                    <option :value="'custom_' + template.id" x-text="template.name + ' (Custom)'"></option>
                                </template>
                            </optgroup>
                        </template>
                    </select>
                    <template x-if="customTemplates.length > 0">
                        <div class="mt-3 p-3 rounded-lg transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border border-gray-600' : 'bg-purple-50 border border-purple-200'">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-sm font-medium transition-colors duration-300" :class="darkMode ? 'text-purple-300' : 'text-purple-800'">
                                    <i class="fas fa-folder mr-1"></i>My Custom Templates (<span x-text="customTemplates.length"></span>)
                                </h4>
                                <button @click="showTemplateManager = !showTemplateManager" class="text-xs transition-colors duration-300" :class="darkMode ? 'text-purple-300 hover:text-purple-100' : 'text-purple-600 hover:text-purple-800'">
                                    <span x-show="!showTemplateManager">Show</span>
                                    <span x-show="showTemplateManager">Hide</span>
                                    <i class="fas ml-1" :class="showTemplateManager ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                                </button>
                            </div>
                            <div x-show="showTemplateManager" x-cloak class="space-y-2 max-h-48 overflow-y-auto">
                                <template x-for="template in customTemplates" :key="template.id">
                                    <div class="flex items-center justify-between p-2 rounded transition-colors duration-300" :class="darkMode ? 'bg-gray-800 hover:bg-gray-750' : 'bg-white hover:bg-gray-50'">
                                        <div class="flex-1">
                                            <div class="text-sm font-medium transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'" x-text="template.name"></div>
                                            <div class="text-xs transition-colors duration-300" :class="darkMode ? 'text-gray-400' : 'text-gray-600'">
                                                <span x-text="template.category" class="capitalize"></span>
                                                <template x-if="template.description">
                                                    <span> â€¢ <span x-text="template.description.substring(0, 50) + (template.description.length > 50 ? '...' : '')"></span></span>
                                                </template>
                                            </div>
                                        </div>
                                        <div class="flex gap-1 ml-2">
                                            <button @click="selectedTemplate = 'custom_' + template.id; applyTemplate()" class="p-1 rounded text-xs transition-colors duration-300" :class="darkMode ? 'text-green-400 hover:bg-green-400 hover:text-gray-900' : 'text-green-600 hover:bg-green-100'" title="Use Template">
                                                <i class="fas fa-play"></i>
                                            </button>
                                            <button @click="editCustomTemplate(template.id)" class="p-1 rounded text-xs transition-colors duration-300" :class="darkMode ? 'text-blue-400 hover:bg-blue-400 hover:text-gray-900' : 'text-blue-600 hover:bg-blue-100'" title="Edit Template">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button @click="duplicateCustomTemplate(template.id)" class="p-1 rounded text-xs transition-colors duration-300" :class="darkMode ? 'text-yellow-400 hover:bg-yellow-400 hover:text-gray-900' : 'text-yellow-600 hover:bg-yellow-100'" title="Duplicate Template">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button @click="deleteCustomTemplate(template.id)" class="p-1 rounded text-xs transition-colors duration-300" :class="darkMode ? 'text-red-400 hover:bg-red-400 hover:text-gray-900' : 'text-red-600 hover:bg-red-100'" title="Delete Template">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Personal Information -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-4 transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Your Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Full Name *</label>
                            <input type="text" x-model="form.requesterName" placeholder="John Doe" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Email Address *</label>
                            <input type="email" x-model="form.requesterEmail" placeholder="john@example.com" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Phone Number</label>
                            <input type="tel" x-model="form.requesterPhone" placeholder="(555) 123-4567" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Organization (if applicable)</label>
                            <input type="text" x-model="form.requesterOrganization" placeholder="News Organization" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Mailing Address</label>
                        <textarea x-model="form.requesterAddress" placeholder="123 Main St, City, State 12345" rows="3" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'"></textarea>
                    </div>
                </div>

                <!-- Agency Information -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-4 transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Agency Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Agency Name *</label>
                            <input type="text" x-model="form.agencyName" placeholder="City Police Department" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Department (if applicable)</label>
                            <input type="text" x-model="form.agencyDepartment" placeholder="Records Division" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Records Officer/Contact</label>
                            <input type="text" x-model="form.agencyContact" placeholder="Records Officer" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Agency Address</label>
                        <textarea x-model="form.agencyAddress" placeholder="456 Government St, City, State 12345" rows="3" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'"></textarea>
                    </div>
                </div>

                <!-- Request Details -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-4 transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Request Details</h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Subject Line *</label>
                        <input type="text" x-model="form.subject" placeholder="Public Records Request - Police Report" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Records Description *</label>
                        <textarea x-model="form.recordsDescription" placeholder="I am requesting copies of all police reports related to incident #12345 that occurred on January 1, 2025, including any supplemental reports, witness statements, and photographs." rows="4" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'" required></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Date Range (From)</label>
                            <input type="date" x-model="form.dateFrom" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Date Range (To)</label>
                            <input type="date" x-model="form.dateTo" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Preferred Format</label>
                        <div class="flex flex-wrap gap-4">
                            <label class="flex items-center">
                                <input type="radio" x-model="form.preferredFormat" value="electronic" class="mr-2">
                                <span class="text-sm transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'">Electronic (PDF/Email)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" x-model="form.preferredFormat" value="paper" class="mr-2">
                                <span class="text-sm transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'">Paper Copies</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" x-model="form.preferredFormat" value="inspection" class="mr-2">
                                <span class="text-sm transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'">Inspection Only</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Additional Options -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-4 transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Additional Options</h3>
                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="checkbox" x-model="form.expeditedProcessing" class="mr-2">
                            <span class="text-sm transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'">Request expedited processing</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" x-model="form.feeWaiverRequest" class="mr-2">
                            <span class="text-sm transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'">Request fee waiver (public interest)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" x-model="form.publicInterest" class="mr-2">
                            <span class="text-sm transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'">This request serves the public interest</span>
                        </label>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Additional Notes</label>
                        <textarea x-model="form.additionalNotes" placeholder="Any additional context or special instructions..." rows="3" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'"></textarea>
                    </div>
                </div>
            </div>

            <!-- Template Customization Wizard Modal -->
            <div x-show="showTemplateWizard" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto transition-colors duration-300" :class="darkMode ? 'bg-gray-800' : 'bg-white'">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">
                                <i class="fas fa-magic mr-2 text-purple-600"></i>Template Customization Wizard
                            </h2>
                            <button @click="closeTemplateWizard()" class="transition-colors duration-300 hover:bg-gray-200 dark:hover:bg-gray-700 p-2 rounded-full" :class="darkMode ? 'text-gray-300' : 'text-gray-600'">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <!-- Wizard Steps -->
                        <div class="mb-6">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-colors" :class="wizardStep >= 1 ? 'bg-purple-600 text-white' : (darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-600')">1</div>
                                        <span class="ml-2 text-sm font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Basic Info</span>
                                    </div>
                                    <div class="w-8 h-0.5 transition-colors" :class="wizardStep >= 2 ? 'bg-purple-600' : (darkMode ? 'bg-gray-700' : 'bg-gray-200')"></div>
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-colors" :class="wizardStep >= 2 ? 'bg-purple-600 text-white' : (darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-600')">2</div>
                                        <span class="ml-2 text-sm font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Content</span>
                                    </div>
                                    <div class="w-8 h-0.5 transition-colors" :class="wizardStep >= 3 ? 'bg-purple-600' : (darkMode ? 'bg-gray-700' : 'bg-gray-200')"></div>
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-colors" :class="wizardStep >= 3 ? 'bg-purple-600 text-white' : (darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-600')">3</div>
                                        <span class="ml-2 text-sm font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Preview & Save</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 1: Basic Information -->
                        <div x-show="wizardStep === 1" class="space-y-6">
                            <div>
                                <h3 class="text-lg font-semibold mb-4 transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Template Basic Information</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Template Name *</label>
                                        <input type="text" x-model="customTemplate.name" placeholder="My Custom Template" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Category</label>
                                        <select x-model="customTemplate.category" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'">
                                            <option value="general">General Records</option>
                                            <option value="police">Police Records</option>
                                            <option value="financial">Financial Records</option>
                                            <option value="personnel">Personnel Records</option>
                                            <option value="legal">Legal Documents</option>
                                            <option value="environmental">Environmental Records</option>
                                            <option value="healthcare">Healthcare Records</option>
                                            <option value="education">Education Records</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Template Description</label>
                                    <textarea x-model="customTemplate.description" placeholder="Describe what this template is for and when to use it..." rows="3" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Content Configuration -->
                        <div x-show="wizardStep === 2" class="space-y-6">
                            <div>
                                <h3 class="text-lg font-semibold mb-4 transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Template Content</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Subject Line Template *</label>
                                        <input type="text" x-model="customTemplate.subject" placeholder="Public Records Request - [DESCRIPTION]" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'" required>
                                        <p class="text-xs mt-1 transition-colors duration-300" :class="darkMode ? 'text-gray-400' : 'text-gray-600'">Use [DESCRIPTION] as a placeholder for specific details</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Records Description Template *</label>
                                        <textarea x-model="customTemplate.recordsDescription" placeholder="I am requesting access to [SPECIFIC RECORDS] related to [TOPIC/INCIDENT] from [DATE RANGE]..." rows="4" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'" required></textarea>
                                        <p class="text-xs mt-1 transition-colors duration-300" :class="darkMode ? 'text-gray-400' : 'text-gray-600'">Use placeholders like [SPECIFIC RECORDS], [TOPIC/INCIDENT], [DATE RANGE] for customization</p>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Default Preferred Format</label>
                                            <select x-model="customTemplate.preferredFormat" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'">
                                                <option value="">No preference</option>
                                                <option value="electronic">Electronic (PDF/Email)</option>
                                                <option value="paper">Paper Copies</option>
                                                <option value="inspection">Inspection Only</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Typical Agency Type</label>
                                            <input type="text" x-model="customTemplate.agencyType" placeholder="Police Department, City Hall, etc." class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Default Options</label>
                                        <div class="space-y-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="customTemplate.expeditedProcessing" class="mr-2">
                                                <span class="text-sm transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'">Request expedited processing by default</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="customTemplate.feeWaiverRequest" class="mr-2">
                                                <span class="text-sm transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'">Request fee waiver by default</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="customTemplate.publicInterest" class="mr-2">
                                                <span class="text-sm transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'">Claim public interest by default</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Additional Notes Template</label>
                                        <textarea x-model="customTemplate.additionalNotes" placeholder="Standard additional notes or context for this type of request..." rows="3" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Preview and Save -->
                        <div x-show="wizardStep === 3" class="space-y-6">
                            <div>
                                <h3 class="text-lg font-semibold mb-4 transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Template Preview</h3>
                                <div class="rounded-lg p-4 transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border border-gray-600' : 'bg-gray-50 border border-gray-200'">
                                    <div class="mb-4">
                                        <h4 class="font-medium mb-2 transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Template Summary</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <span class="font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Name:</span>
                                                <span x-text="customTemplate.name || 'Untitled Template'" class="ml-2 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'"></span>
                                            </div>
                                            <div>
                                                <span class="font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Category:</span>
                                                <span x-text="customTemplate.category || 'general'" class="ml-2 capitalize transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'"></span>
                                            </div>
                                            <div class="md:col-span-2">
                                                <span class="font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">Subject:</span>
                                                <span x-text="customTemplate.subject || 'No subject template'" class="ml-2 transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-900'"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="border-t pt-4 transition-colors duration-300" :class="darkMode ? 'border-gray-600' : 'border-gray-200'">
                                        <h4 class="font-medium mb-2 transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Records Description Preview</h4>
                                        <div class="text-sm font-mono p-3 rounded transition-colors duration-300" :class="darkMode ? 'bg-gray-800 text-gray-300' : 'bg-white text-gray-700'" x-text="customTemplate.recordsDescription || 'No description template'"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="flex justify-between pt-6 border-t transition-colors duration-300" :class="darkMode ? 'border-gray-700' : 'border-gray-200'">
                            <div>
                                <button x-show="wizardStep > 1" @click="wizardStep--" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md transition-colors">
                                    <i class="fas fa-arrow-left mr-2"></i>Previous
                                </button>
                            </div>
                            <div class="flex gap-2">
                                <button @click="closeTemplateWizard()" class="transition-colors duration-300 hover:bg-gray-200 dark:hover:bg-gray-700 px-4 py-2 rounded-md" :class="darkMode ? 'text-gray-300' : 'text-gray-600'">
                                    Cancel
                                </button>
                                <button x-show="wizardStep < 3" @click="wizardStep++" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md transition-colors">
                                    Next<i class="fas fa-arrow-right ml-2"></i>
                                </button>
                                <button x-show="wizardStep === 3" @click="saveCustomTemplate()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-colors" :disabled="!customTemplate.name || !customTemplate.subject || !customTemplate.recordsDescription">
                                    <i class="fas fa-save mr-2"></i>Save Template
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Section -->
            <div class="rounded-lg shadow-md p-6 transition-colors duration-300" :class="darkMode ? 'bg-gray-800' : 'bg-white'">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold transition-colors duration-300" :class="darkMode ? 'text-white' : 'text-gray-900'">Letter Preview</h2>
                    <div class="flex gap-2">
                        <button @click="copyToClipboard()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm transition-colors">
                            <i class="fas fa-copy mr-2"></i>Copy
                        </button>
                        <button @click="exportAsText()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm transition-colors">
                            <i class="fas fa-download mr-2"></i>TXT
                        </button>
                        <button @click="exportAsPDF()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm transition-colors">
                            <i class="fas fa-file-pdf mr-2"></i>PDF
                        </button>
                    </div>
                </div>
                
                <!-- State Legal Information Panel -->
                <template x-if="selectedLaw">
                    <div class="mb-6 p-4 rounded-lg transition-colors duration-300" :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-green-50 border-green-200'" style="border: 1px solid;">
                        <h3 class="text-lg font-semibold mb-3 transition-colors duration-300" :class="darkMode ? 'text-green-300' : 'text-green-800'">
                            <i class="fas fa-balance-scale mr-2"></i>Legal Information for <span x-text="selectedLaw.name"></span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <h4 class="font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-200' : 'text-gray-800'">Response Requirements:</h4>
                                <p class="transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-600'" x-text="selectedLaw.responseDetails"></p>
                            </div>
                            <div>
                                <h4 class="font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-200' : 'text-gray-800'">Fee Information:</h4>
                                <p class="transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-600'" x-text="selectedLaw.feeDetails"></p>
                            </div>
                            <template x-if="selectedLaw.expeditedProcessing && selectedLaw.expeditedCriteria">
                                <div>
                                    <h4 class="font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-200' : 'text-gray-800'">Expedited Processing:</h4>
                                    <p class="transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-600'" x-text="selectedLaw.expeditedCriteria"></p>
                                </div>
                            </template>
                            <div>
                                <h4 class="font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-200' : 'text-gray-800'">Appeal Process:</h4>
                                <p class="transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-600'" x-text="selectedLaw.appealProcess"></p>
                            </div>
                        </div>
                        <template x-if="selectedLaw.contactInfo">
                            <div class="mt-3 pt-3 border-t transition-colors duration-300" :class="darkMode ? 'border-gray-600' : 'border-green-200'">
                                <h4 class="font-medium transition-colors duration-300" :class="darkMode ? 'text-gray-200' : 'text-gray-800'">State Attorney General Contact:</h4>
                                <div class="flex flex-wrap gap-4 text-sm">
                                    <template x-if="selectedLaw.contactInfo.website">
                                        <a :href="selectedLaw.contactInfo.website" target="_blank" class="text-blue-600 hover:text-blue-800 transition-colors">
                                            <i class="fas fa-globe mr-1"></i>Website
                                        </a>
                                    </template>
                                    <template x-if="selectedLaw.contactInfo.phone">
                                        <span class="transition-colors duration-300" :class="darkMode ? 'text-gray-300' : 'text-gray-600'">
                                            <i class="fas fa-phone mr-1"></i><span x-text="selectedLaw.contactInfo.phone"></span>
                                        </span>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
                
                <!-- Letter Content -->
                <div id="letterPreview" class="border rounded-md p-6 min-h-96 font-mono text-sm leading-relaxed transition-colors duration-300" :class="darkMode ? 'border-gray-600 bg-gray-900 text-white' : 'border-gray-200 bg-white text-gray-900'">
                    <div class="letter-content">
                        <!-- Date -->
                        <div class="mb-6 text-right" x-text="getCurrentDate()"></div>
                        
                        <!-- Agency Address -->
                        <div class="mb-6">
                            <template x-if="form.agencyContact">
                                <div x-text="form.agencyContact"></div>
                            </template>
                            <template x-if="form.agencyName">
                                <div x-text="form.agencyName"></div>
                            </template>
                            <template x-if="form.agencyDepartment">
                                <div x-text="form.agencyDepartment"></div>
                            </template>
                            <template x-if="form.agencyAddress">
                                <div x-html="form.agencyAddress.replace(/\n/g, '<br>')"></div>
                            </template>
                        </div>
                        
                        <!-- Subject Line -->
                        <div class="mb-6">
                            <strong>RE: <span x-text="form.subject || 'Public Records Request'"></span></strong>
                        </div>
                        
                        <!-- Salutation -->
                        <div class="mb-4">
                            <template x-if="form.agencyContact">
                                <span>Dear <span x-text="form.agencyContact"></span>,</span>
                            </template>
                            <template x-if="!form.agencyContact">
                                <span>To Whom It May Concern:</span>
                            </template>
                        </div>
                        
                        <!-- Opening paragraph -->
                        <div class="mb-4">
                            I am writing to request access to public records under 
                            <span x-text="getStateCitation()"></span>. 
                            <template x-if="form.requesterOrganization">
                                I am making this request on behalf of <span x-text="form.requesterOrganization"></span>.
                            </template>
                        </div>
                        
                        <!-- Records description -->
                        <div class="mb-4">
                            <strong>Specifically, I am requesting:</strong>
                        </div>
                        <div class="mb-4 pl-4">
                            <span x-text="form.recordsDescription || 'Please describe the records you are requesting...'"></span>
                            
                            <template x-if="form.dateFrom || form.dateTo">
                                <div class="mt-2">
                                    <strong>Date Range:</strong>
                                    <template x-if="form.dateFrom && form.dateTo">
                                        <span x-text="formatDate(form.dateFrom) + ' to ' + formatDate(form.dateTo)"></span>
                                    </template>
                                    <template x-if="form.dateFrom && !form.dateTo">
                                        <span>From <span x-text="formatDate(form.dateFrom)"></span></span>
                                    </template>
                                    <template x-if="!form.dateFrom && form.dateTo">
                                        <span>Through <span x-text="formatDate(form.dateTo)"></span></span>
                                    </template>
                                </div>
                            </template>
                        </div>
                        
                        <!-- Format preference -->
                        <template x-if="form.preferredFormat">
                            <div class="mb-4">
                                I would prefer to receive these records in 
                                <span x-text="getFormatPreference()"></span> format.
                            </div>
                        </template>
                        
                        <!-- Fee waiver request -->
                        <template x-if="form.feeWaiverRequest">
                            <div class="mb-4">
                                I request that any fees associated with this request be waived as this information is being sought in the public interest and will contribute to public understanding of government operations.
                            </div>
                        </template>
                        
                        <!-- Expedited processing -->
                        <template x-if="form.expeditedProcessing">
                            <div class="mb-4">
                                I request expedited processing of this request due to its time-sensitive nature.
                            </div>
                        </template>
                        
                        <!-- Additional notes -->
                        <template x-if="form.additionalNotes">
                            <div class="mb-4">
                                <span x-text="form.additionalNotes"></span>
                            </div>
                        </template>
                        
                        <!-- Legal requirements -->
                        <div class="mb-4">
                            <span x-text="getLegalRequirements()"></span>
                        </div>
                        
                        <!-- Contact information -->
                        <div class="mb-4">
                            If you have any questions about this request, please contact me at 
                            <span x-text="form.requesterEmail || 'your-email@example.com'"></span>
                            <template x-if="form.requesterPhone">
                                or <span x-text="form.requesterPhone"></span>
                            </template>.
                        </div>
                        
                        <!-- Closing -->
                        <div class="mb-6">
                            Thank you for your time and consideration.
                        </div>
                        
                        <div class="mb-4">
                            Sincerely,
                        </div>
                        
                        <!-- Signature block -->
                        <div class="mb-2">
                            <span x-text="form.requesterName || 'Your Name'"></span>
                        </div>
                        <template x-if="form.requesterOrganization">
                            <div class="mb-2">
                                <span x-text="form.requesterOrganization"></span>
                            </div>
                        </template>
                        <template x-if="form.requesterAddress">
                            <div class="mb-2">
                                <span x-html="form.requesterAddress.replace(/\n/g, '<br>')"></span>
                            </div>
                        </template>
                        <div class="mb-2">
                            <span x-text="form.requesterEmail || 'your-email@example.com'"></span>
                        </div>
                        <template x-if="form.requesterPhone">
                            <div class="mb-2">
                                <span x-text="form.requesterPhone"></span>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Disclaimer -->
        <div class="mt-8 bg-yellow-50 border border-yellow-200 rounded-md p-4">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-yellow-800">Legal Disclaimer</h3>
                    <div class="mt-2 text-sm text-yellow-700">
                        <p>This tool provides general information and generates template letters for public records requests. It does not constitute legal advice. Laws vary by jurisdiction, and specific circumstances may require different approaches. Consult with a qualified attorney for legal advice specific to your situation.</p>
                        <p class="mt-2"><strong>Privacy Notice:</strong> All processing is done locally in your browser. No data is transmitted to external servers or stored by this application.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/app.js"></script>
    <script src="js/pdf-generator.js"></script>
</body>
</html>
